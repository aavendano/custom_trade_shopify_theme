{% doc %}
  @prompt
  for the geolocation landing page, generate a block with a embed google map (static). It needs to load the map from a
  url dynamic source. ex: "https://maps.app.goo.gl/Ezbx86ZoyiE362wT6"

  Add title with controls to vary font size, type, color and type. add text dynamically filled add a CTA buton , Make
  sure the map shows , make the content direction adjustable and responsible , add border, round corners and shadow to
  the map , make map width adjustable
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}
{% assign city = block.settings.City | url_encode %}
{% assign province = block.settings.Province | url_encode %}
{% assign country = block.settings.Country | url_encode %}
{% assign map_width = block.settings.map_width %}
{% assign map_height = block.settings.map_height %}
{% assign map_zoom = block.settings.map_zoom | default: 14 %}
{% assign map_api_key = block.settings.GoogleMapsAPIKey %}
{% assign schema_area_served = block.settings.schema_area_served %}

{% style %}
  .ai-map-block-{{ ai_gen_id }} {
    display: flex;
    flex-direction: {{ block.settings.content_direction }};
    gap: {{ block.settings.content_gap }}px;
    padding: {{ block.settings.padding }}px;
    background-color: {{ block.settings.background_color }};
    border-radius: {{ block.settings.border_radius }}px;
  }

  .ai-map-content-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    gap: 16px;
    flex: {{ block.settings.content_width }}%;
    min-width: 0;
  }
  .ai-other_areas-content-{{ ai_gen_id }} {
    display: flex;
    flex-direction: row;
    gap: 16px;
    flex: 100%;
    min-width: 0;
  }
  .ai-map-embed-wrapper-{{ ai_gen_id }} {
    flex: {{ block.settings.map_container_width }}%;
    min-width: 0;
    border: {{ block.settings.map_border_width }}px solid {{ block.settings.map_border_color }};
    border-radius: {{ block.settings.map_border_radius }}px;
    overflow: hidden;
    box-shadow: {{ block.settings.map_shadow_h_offset }}px {{ block.settings.map_shadow_v_offset }}px {{ block.settings.map_shadow_blur }}px {{ block.settings.map_shadow_spread }}px {{ block.settings.map_shadow_color }};
  }

  .ai-map-title-{{ ai_gen_id }} {
    font-family: {{ block.settings.title_font.family }}, sans-serif;
    font-weight: {{ block.settings.title_font.weight }};
    font-size: {{ block.settings.title_size }}px;
    color: {{ block.settings.title_color }};
    margin: 0 0 8px 0;
    line-height: 1.2;
  }

  .ai-map-text-{{ ai_gen_id }} {
    font-size: {{ block.settings.text_size }}px;
    color: {{ block.settings.text_color }};
    line-height: 1.5;
    margin: 0;
  }

  .ai-map-embed-{{ ai_gen_id }} {
    width: 100%;
    height: {{ block.settings.map_height }}px;
    border: none;
    overflow: hidden;
  }

  .ai-map-cta-{{ ai_gen_id }} {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 12px 24px;
    background-color: {{ block.settings.button_color }};
    color: {{ block.settings.button_text_color }};
    text-decoration: none;
    border-radius: {{ block.settings.button_border_radius }}px;
    font-weight: 600;
    transition: background-color 0.3s ease;
    align-self: {{ block.settings.button_alignment }};
    min-width: 120px;
    text-align: center;
  }

  .ai-map-cta-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.button_hover_color }};
  }

  .ai-map-placeholder-{{ ai_gen_id }} {
    width: 100%;
    height: {{ block.settings.map_height }}px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f4f4f4;
  }

  .ai-map-placeholder-{{ ai_gen_id }} svg {
    width: 50%;
    height: 50%;
    opacity: 0.5;
  }

  @media screen and (max-width: 749px) {
    .ai-map-block-{{ ai_gen_id }} {
      flex-direction: {{ block.settings.mobile_content_direction }};
      padding: {{ block.settings.padding | divided_by: 1.5 }}px;
      gap: {{ block.settings.content_gap | divided_by: 1.5 }}px;
    }

    .ai-map-content-{{ ai_gen_id }} {
      flex: 100%;
    }

    .ai-map-embed-wrapper-{{ ai_gen_id }} {
      flex: 100%;
    }

    .ai-map-title-{{ ai_gen_id }} {
      font-size: {{ block.settings.title_size | times: 0.8 }}px;
    }

    .ai-map-embed-{{ ai_gen_id }} {
      height: {{ block.settings.map_height | times: 0.7 }}px;
    }

    .ai-map-placeholder-{{ ai_gen_id }} {
      height: {{ block.settings.map_height | times: 0.7 }}px;
    }
  }
{% endstyle %}

<div class="ai-map-block-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-map-content-{{ ai_gen_id }}">
    {% if block.settings.title != blank %}
      <h2 class="ai-map-title-{{ ai_gen_id }}">{{ block.settings.title }}</h2>
    {% endif %}

    {% if block.settings.text != blank %}
      <div class="ai-map-text-{{ ai_gen_id }}">{{ block.settings.text }}</div>
    {% endif %}

    {% if block.settings.button_text != blank and block.settings.button_link != blank %}
      <a href="{{ block.settings.button_link }}" class="ai-map-cta-{{ ai_gen_id }}">
        {{ block.settings.button_text }}
      </a>
    {% endif %}
  </div>
  <div class="ai-map-embed-wrapper-{{ ai_gen_id }}">
    {% if block.settings.show_map %}
      <iframe
        src="https://www.google.com/maps/embed/v1/place?q={%if city != blank and city != 'None' %}{{ city }}+{% endif %}{{ province }}+{{ country }}&zoom={{ map_zoom }}&key={{ map_api_key }}"
        alt="{{ city | url_encode }}-{{ province | url_encode }}-{{ country | url_encode }}-Service-Area-PlayLoveToys"
        height="{{ map_height }}"
        width="{{ map_width }}"
      >
      </iframe>
    {% endif %}
  </div>
</div>

{% if schema_area_served %}
  {% assign area_served_type_city = false %}
  {% if metaobject.system.type == 'location_page' %}
    {% assign province = metaobject.province %}
    {% assign province_code = metaobjects.region[province].province_code %}
    {% assign area_served_type_city = true %}

    {% if city == blank or city == 'None' %}
      {% assign area_name = province %}
    {% else %}
      {% assign area_name = city %}
      {% assign area_name_full = city | append: ', ' | append: province_code %}
    {% endif %}

  {% else %}
    {% assign area_name = province %}
    {% assign area_name_full = province | append: ', ' | append: 'Canada' %}
    {% assign province_code = metaobject.province_code %}
  {% endif %}

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Service",
      "name": "Online Retail of Couples' Sex Toys and Wellness Products in {{ area_name_full }}",
      "description": "PlayLoveToys is a safe, inclusive, and empowering Canadian online source for high-quality, ethically sourced sex toys and sexual wellness information, serving couples across {{ area_name_full }}.",
      "provider": {
        "@type": "Organization",
        "name": "PlayLoveToys",
        "url": "{{ shop.url }}",
        "logo": "https://cdn.shopify.com/s/files/1/0603/8198/6891/files/logo_transparent_background_square_768x768_65346903-4d6a-4994-b915-c43edcc06000.png"
      },
      "areaServed": {
        "@type": {% if area_served_type_city %}"City"{% else %}"AdministrativeArea"{% endif %},
          "name": "{{ area_name }}",
          "address": {
            "@type": "PostalAddress",
            "addressCountry": "CA",
            "addressRegion": "{{ province_code }}"
            {% if area_served_type_city %}, "addressLocality": "{{ area_name }}"{% endif %}
          }
      },
      "hoursAvailable": {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": [
          "Monday",
          "Tuesday",
          "Wednesday",
          "Thursday",
          "Friday",
          "Saturday",
          "Sunday"
        ],
        "opens": "00:00",
        "closes": "23:59"
      },

      "serviceType": "E-commerce for Adult Wellness Products",
      "availableChannel": {
        "@type": "ServiceChannel",
        "serviceUrl": "{{ shop.url }}{{ request.path }}",
        "description": "Online store accessible 24/7 with discreet shipping to all of {{ area_name_full }}."
      },
      "audience": {
        "@type": "Audience",
        "audienceType": "Couples aged 25-55",
        "geographicArea": {
          "@type": {% if area_served_type_city %}"City"{% else %}"AdministrativeArea"{% endif %},
          "name": "{{ area_name_full }}"
        }
      },
      "offers": {
        "@type": "Offer",
        "businessFunction": "http://purl.org/goodrelations/v1#Sell",
        "priceCurrency": "CAD"
      },
      "termsOfService": "{{ shop.url }}/policies/terms-of-service"
    }
  </script>
{% endif %}

{% schema %}
{
  "name": "Location Map",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "content_direction",
      "label": "Content direction (desktop)",
      "options": [
        {
          "value": "row",
          "label": "Content left, Map right"
        },
        {
          "value": "row-reverse",
          "label": "Map left, Content right"
        },
        {
          "value": "column",
          "label": "Content top, Map bottom"
        },
        {
          "value": "column-reverse",
          "label": "Map top, Content bottom"
        }
      ],
      "default": "row"
    },
    {
      "type": "select",
      "id": "mobile_content_direction",
      "label": "Content direction (mobile)",
      "options": [
        {
          "value": "row",
          "label": "Content left, Map right"
        },
        {
          "value": "row-reverse",
          "label": "Map left, Content right"
        },
        {
          "value": "column",
          "label": "Content top, Map bottom"
        },
        {
          "value": "column-reverse",
          "label": "Map top, Content bottom"
        }
      ],
      "default": "column"
    },
    {
      "type": "range",
      "id": "content_width",
      "min": 20,
      "max": 80,
      "step": 5,
      "unit": "%",
      "label": "Content width (desktop)",
      "default": 50,
      "info": "Only applies when content and map are side by side"
    },
    {
      "type": "range",
      "id": "map_container_width",
      "min": 20,
      "max": 80,
      "step": 5,
      "unit": "%",
      "label": "Map container width (desktop)",
      "default": 50,
      "info": "Only applies when content and map are side by side"
    },
    {
      "type": "range",
      "id": "content_gap",
      "min": 8,
      "max": 80,
      "step": 4,
      "unit": "px",
      "label": "Space between content and map",
      "default": 32
    },
    {
      "type": "range",
      "id": "padding",
      "min": 0,
      "max": 60,
      "step": 4,
      "unit": "px",
      "label": "Padding",
      "default": 24
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#FFFFFF"
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Border radius",
      "default": 0
    },
    {
      "type": "header",
      "content": "Map Settings"
    },

    {
      "type": "text",
      "id": "map_width",
      "label": "Ancho del mapa",
      "default": "600"
    },
    {
      "type": "text",
      "id": "map_height",
      "label": "Alto del mapa",
      "default": "450"
    },
    {
      "type": "text",
      "id": "City",
      "label": "Ciudad",
      "default": "None"
    },
    {
      "type": "text",
      "id": "Province",
      "label": "Provincia/Estado",
      "default": "Ontario"
    },
    {
      "type": "text",
      "id": "Country",
      "label": "Pa√≠s",
      "default": "Canada"
    },
    {
      "type": "text",
      "id": "GoogleMapsAPIKey",
      "label": "Google Maps API Key",
      "default": "YOUR_GOOGLE_MAPS_API_KEY"
    },
    {
      "type": "text",
      "id": "map_zoom",
      "label": "Map zoom level",
      "default": "14",
      "info": "Adjust the zoom level of the map. Default is 14. Higher values zoom in closer."
    },
    {
      "type": "checkbox",
      "id": "show_map",
      "label": "Activate map",
      "default": false
    },

    {
      "type": "checkbox",
      "id": "schema_area_served",
      "label": "Schema Area Served",
      "default": false,
      "info": "Enable this to add schema.org structured data for the service area."
    },

    {
      "type": "header",
      "content": "Map Styling"
    },
    {
      "type": "range",
      "id": "map_border_radius",
      "min": 0,
      "max": 30,
      "step": 1,
      "unit": "px",
      "label": "Map border radius",
      "default": 12
    },
    {
      "type": "range",
      "id": "map_border_width",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "px",
      "label": "Map border width",
      "default": 1
    },
    {
      "type": "color",
      "id": "map_border_color",
      "label": "Map border color",
      "default": "#DDDDDD"
    },
    {
      "type": "range",
      "id": "map_shadow_h_offset",
      "min": -20,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Shadow horizontal offset",
      "default": 0
    },
    {
      "type": "range",
      "id": "map_shadow_v_offset",
      "min": -20,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Shadow vertical offset",
      "default": 4
    },
    {
      "type": "range",
      "id": "map_shadow_blur",
      "min": 0,
      "max": 40,
      "step": 1,
      "unit": "px",
      "label": "Shadow blur",
      "default": 10
    },
    {
      "type": "range",
      "id": "map_shadow_spread",
      "min": -10,
      "max": 10,
      "step": 1,
      "unit": "px",
      "label": "Shadow spread",
      "default": 0
    },
    {
      "type": "color",
      "id": "map_shadow_color",
      "label": "Shadow color",
      "default": "rgba(0,0,0,0.1)"
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Find us here"
    },
    {
      "type": "font_picker",
      "id": "title_font",
      "label": "Title font",
      "default": "helvetica_n4"
    },
    {
      "type": "range",
      "id": "title_size",
      "min": 16,
      "max": 60,
      "step": 1,
      "unit": "px",
      "label": "Title size",
      "default": 32
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title color",
      "default": "#000000"
    },
    {
      "type": "richtext",
      "id": "text",
      "label": "Text",
      "default": "<p>Visit our store to discover our products in person. We're open Monday to Friday from 9am to 6pm, and Saturday from 10am to 4pm.</p>"
    },
    {
      "type": "range",
      "id": "text_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Text size",
      "default": 16
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#333333"
    },
    {
      "type": "header",
      "content": "Button"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Get Directions"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button link"
    },
    {
      "type": "select",
      "id": "button_alignment",
      "label": "Button alignment",
      "options": [
        {
          "value": "flex-start",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "flex-end",
          "label": "Right"
        }
      ],
      "default": "flex-start"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button color",
      "default": "#4285F4"
    },
    {
      "type": "color",
      "id": "button_hover_color",
      "label": "Button hover color",
      "default": "#3367D6"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text color",
      "default": "#FFFFFF"
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Button border radius",
      "default": 4
    }
  ],
  "presets": [
    {
      "name": "Location Map"
    }
  ]
}
{% endschema %}
